---
title: "Data Import Script"
format: html
---

```{r packages}
library(tidyverse)
library(httr2)
library(rvest)
library(readr)
library(stringr)
```

```{r}

alphabet <- LETTERS

read_page <- function(url,char){
    read_html(paste0(url,char)) |> 
    html_elements("li") |> 
    html_element(".category-page__member-link") |>
    html_text2()
}
for (char in alphabet){
value <- read_page("https://wot.fandom.com/wiki/Category:Women?from=",char)
  assign(paste0("vector_women",char),value,envir = .GlobalEnv)

}
names_list_women <- vector_womenA
for (char in alphabet){
  names_list_women <- c(names_list_women,get(paste0("vector_women",char)))
}

names_tibble_women <- tibble(names_list_women) |> 
  drop_na() |> 
  distinct()



```

```{r}
all_names_objects_data <- list()
scrape_names <- function(name){
  scraped_data <- read_html(paste0("https://wot.fandom.com/wiki/",name)) |> 
    html_elements("section") |> 
    html_elements(".pi-border-color") |>
    html_text2()
  unnamed_list <- strsplit(scraped_data,"\n")
  named_vector <- sapply(unnamed_list, function(x) x[2], simplify = "vector")
  names(named_vector) <- sapply(unnamed_list, function(x) x[1], simplify = "vector")
  tibble <- named_vector |> 
    enframe(name = "variable", value = "value") |> 
    mutate(name = name)
  tibble <- list(tibble)
  assign("all_names_objects_data",c(all_names_objects_data,tibble),envir = .GlobalEnv)
"done"
}
list <- list(Catala_Lucanvalle)
scrape_names("Reanne_Corly")

egwene <- read_html("https://wot.fandom.com/wiki/Egwene_al%27Vere") |> 
    html_elements("section") |> 
    html_elements(".pi-border-color") |>
    html_text2()

unnamed_list <- strsplit(egwene,"\n")

named_vector <- sapply(unnamed_list, function(x) x[2], simplify = "vector")
names(named_vector) <- sapply(unnamed_list, function(x) x[1], simplify = "vector")
named_vector |> 
  enframe(name = "variable", value = "value") |> 
  mutate(name = deparse(substitute(egwene)))
```


```{r}
alphabet <- LETTERS


for (char in alphabet){
  value <- read_page("https://wot.fandom.com/wiki/Category:Unknown_gender?from=",char)
  assign(paste0("vector_unknown",char),value,envir = .GlobalEnv)

}
names_list_unknown <- vector_unknownA
for (char in alphabet){
  names_list_unknown <- c(names_list_unknown,get(paste0("vector_unknown",char)))
}


names_tibble_unknown <- tibble(names_list_unknown) |> 
  drop_na() |> 
  distinct()

```
```{r}
names_tibble_women |>
  rename(names = 1)|>
  mutate(names = str_replace_all(names, " ", "_"))|>
  mutate(names = str_replace_all(names, "'", "%27")) |> 
  as.tibble() -> names_url_women
```
```{r}
for (names in names_url_women){
  scrape_names(paste(names))
}
bru <- names_url_women |> 
  slice(1:100) |> 
  rowwise() |> 
  mutate(status = scrape_names(paste0(names)))
bru |> 
  arrange(desc(length))
```
```{r}
list_of_tibbles <-  mget(bru$names, envir = .GlobalEnv)
result_df <- do.call(rbind, all_names_objects_data) |> 
  as.tibble() |> 
  filter(name != "Unnamed_characters_in_New_Spring") |> 
  mutate_all(as.character) |> 
  pivot_wider(values_from = value,names_from = variable,values_fill = NA)


```



